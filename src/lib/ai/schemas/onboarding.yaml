# Conversational Onboarding Schema
# Version: 2.0
# Last Updated: 2026-01-21
#
# This schema defines the AI-powered conversational onboarding flow
# that guides new users through profile creation in a natural, engaging way.
#
# v2.0 Changes:
# - Added profile_setup phase (profile picture)
# - Changed age to birthday (month/year)
# - Added location phase (city, optional)
# - Added privacy phase (public/private profile)
# - Improved resilience with step tracking

version: "2.0"
last_updated: "2026-01-21"

onboarding:
  description: "Conversational onboarding flow for new users"
  total_phases: 13

  persona:
    name: "Coach"
    avatar_emoji: "ðŸ’ª"
    traits:
      - warm and encouraging
      - knowledgeable but not preachy
      - asks follow-up questions naturally
      - celebrates user responses
      - explains the "why" behind questions
      - uses casual, conversational language
      - adapts tone to user's energy

    voice_guidelines:
      - Use contractions (I'm, you're, let's)
      - Keep sentences short and punchy
      - Add encouraging affirmations naturally
      - Reference previous answers to show listening
      - Use "we" to build partnership feeling

    boundaries:
      - Never give medical advice
      - Don't promise specific results
      - Respect user privacy choices
      - Accept "skip" or "prefer not to say" gracefully

  phases:
    welcome:
      order: 1
      goal: "Build rapport, get name"
      data_collected:
        - name_preference
      feature_intro: "AI coaching capabilities"
      opening_message: |
        Hey! I'm your AI coach here at Workout Circle.

        Before we start building workouts together, I'd love to get to know you a bit.

        What should I call you?
      quick_replies:
        - null  # No quick replies for name input
      extraction_hints:
        name_preference:
          type: string
          description: "User's preferred name/nickname"
          extraction_prompt: "Extract the name or nickname the user wants to be called"

    profile_setup:
      order: 2
      goal: "Optional profile picture"
      data_collected:
        - profile_picture
      feature_intro: "Personalize your profile"
      optional: true
      transition_message: |
        Nice to meet you, {name}!

        Would you like to add a profile picture? It helps make Workout Circle feel more personal, and if you decide to go public later, others can see who they're connecting with.
      quick_replies:
        - "Add a photo"
        - "Skip for now"
      skip_message: "No worries! You can always add one later from your profile settings."
      extraction_hints:
        profile_picture:
          type: string
          description: "URL of uploaded profile picture"
          optional: true

    motivation:
      order: 3
      goal: "Understand why they're here"
      data_collected:
        - primary_motivation
        - specific_goals_mentioned
      feature_intro: "Goal tracking & personalized workouts"
      transition_message: |
        {profile_acknowledgment}

        So what brings you to Workout Circle? What's driving you to level up your fitness right now?
      quick_replies:
        - "Get stronger"
        - "Lose weight"
        - "Build muscle"
        - "Feel healthier"
      extraction_hints:
        primary_motivation:
          type: enum
          values: [strength, weight_loss, muscle_building, health, sports_performance, energy, mental_health, other]
          description: "The primary reason they want to work out"

    basics:
      order: 4
      goal: "Collect demographic info naturally"
      data_collected:
        - birth_month
        - birth_year
        - gender
        - height
        - weight
      feature_intro: "Progress tracking over time"
      transition_template: |
        {motivation_response}

        To give you the best workout recommendations, I need to know a bit about you.

        When's your birthday? Just month and year is fine - helps me tailor workouts to your experience level.
      quick_replies:
        - null
      follow_up_questions:
        - "And your height? (feet and inches is fine)"
        - "What about your current weight?"
        - "One more - do you identify as male, female, or prefer another term?"
      extraction_hints:
        birth_month:
          type: number
          range: [1, 12]
          description: "User's birth month (1-12)"
          accept_phrases: ["January", "Feb", "March", "April", "May", "June", "July", "Aug", "September", "October", "November", "December"]
        birth_year:
          type: number
          range: [1920, 2015]
          description: "User's birth year"
          accept_phrases: ["born in", "year"]
        gender:
          type: enum
          values: [male, female, other, prefer_not_to_say]
        height:
          type: object
          properties:
            feet: number
            inches: number
          accept_formats: ["X'Y\"", "X feet Y inches", "X ft Y in", "X foot Y"]
        weight:
          type: number
          unit: lbs
          accept_formats: ["X lbs", "X pounds", just a number]

    location:
      order: 5
      goal: "Get optional city for finding workout partners"
      data_collected:
        - city
      feature_intro: "Connect with nearby fitness enthusiasts"
      optional: true
      transition_template: |
        {basics_acknowledgment}

        Quick optional question - what city are you in?

        This can help you find workout partners nearby and connect with people in your area. Totally fine to skip if you prefer!
      quick_replies:
        - "Skip this"
      skip_message: "No problem! You can always add your location later if you want to discover nearby workout partners."
      extraction_hints:
        city:
          type: string
          description: "User's city/location"
          optional: true

    body_composition:
      order: 6
      goal: "Get body metrics for personalization"
      data_collected:
        - body_fat_estimate
        - target_weight
        - physique_goals
      feature_intro: "Body composition tracking & progress photos"
      optional: true
      transition_template: |
        {location_acknowledgment}

        Let's talk body composition. This helps me understand where you're starting from.

        Do you have a rough idea of your body fat percentage? (It's totally fine to guess or skip this!)
      quick_replies:
        - "Not sure"
        - "Around 15-20%"
        - "Around 20-25%"
        - "Over 25%"
      follow_up_questions:
        - "What's your target weight, if you have one? Or are you more focused on how you look/feel?"
      extraction_hints:
        body_fat_estimate:
          type: number
          range: [3, 60]
          optional: true
          description: "Estimated body fat percentage"
        target_weight:
          type: number
          optional: true
          description: "Goal weight in lbs"

    fitness_background:
      order: 7
      goal: "Understand current fitness level"
      data_collected:
        - experience_level
        - current_activity
        - training_frequency
      feature_intro: "AI adapts workouts to your level"
      transition_template: |
        Got it! {basic_summary}

        Now let's talk about where you're at fitness-wise.

        How would you describe your current workout experience?
      quick_replies:
        - "Complete beginner"
        - "Some experience"
        - "Regular gym-goer"
        - "Advanced lifter"
      follow_up_questions:
        - "How many days a week are you currently working out? (It's okay if it's zero!)"
        - "What kinds of workouts do you typically do?"
      extraction_hints:
        experience_level:
          type: enum
          values: [beginner, intermediate, advanced, elite]
          mapping:
            beginner: ["complete beginner", "new to working out", "never worked out", "just starting"]
            intermediate: ["some experience", "worked out before", "on and off", "casual"]
            advanced: ["regular gym-goer", "consistent", "few years", "experienced"]
            elite: ["advanced lifter", "competitive", "years of experience", "athlete"]
        training_frequency:
          type: number
          range: [0, 7]
          description: "Days per week currently training"

    goals:
      order: 8
      goal: "Define specific fitness goals"
      data_collected:
        - primary_goal
        - secondary_goals
        - timeline
      feature_intro: "Goal tracking & milestone celebrations"
      transition_template: |
        {fitness_acknowledgment}

        Now let's get specific about your goals.

        If you could wave a magic wand and achieve ONE fitness goal, what would it be?
      quick_replies:
        - "Lose 20 pounds"
        - "Bench press my bodyweight"
        - "Run a 5K"
        - "Build visible abs"
      follow_up_questions:
        - "Love that goal! Any other fitness wins you're chasing?"
        - "What's your ideal timeline? When do you want to hit these goals by?"
      extraction_hints:
        primary_goal:
          type: object
          properties:
            type: [strength, cardio, weight, skill, aesthetic, health]
            description: string
            target_value: number (optional)
            target_unit: string (optional)
        timeline:
          type: string
          description: "When they want to achieve their goals"
          accept_formats: ["X weeks", "X months", "by [date]", "this year"]

    limitations:
      order: 9
      goal: "Understand any physical limitations"
      data_collected:
        - injuries
        - conditions
        - restrictions
      feature_intro: "Smart exercise filtering - we'll never suggest movements that could hurt you"
      optional: true
      transition_template: |
        {goals_acknowledgment}

        Super important question: Do you have any injuries, physical limitations, or conditions I should know about?

        This helps me make sure every workout is safe for you.
      quick_replies:
        - "Nope, all good!"
        - "Bad back"
        - "Knee issues"
        - "Shoulder problems"
      follow_up_questions:
        - "Got it. Are there any specific movements you know you need to avoid?"
        - "Any other health conditions that affect your training?"
      extraction_hints:
        limitations:
          type: array
          items:
            type: object
            properties:
              body_part: string
              condition: string
              severity: [mild, moderate, severe]
              avoid_movements: array of strings

    current_maxes:
      order: 10
      goal: "Current assessed maxes for workout programming"
      data_collected:
        - key_lifts
        - cardio_benchmarks
        - bodyweight_max_reps
      feature_intro: "Your current maxes help us prescribe the right weights, reps, and intensity"
      optional: true
      transition_template: |
        {limitations_acknowledgment}

        To program your workouts effectively, it helps to know your current abilities.

        Do you know any of your current maxes? These are what you can lift/do NOW, not necessarily all-time bests.
      quick_replies:
        - "I don't know my maxes"
        - "I have some numbers"
        - "I'm mostly doing cardio"
      follow_up_questions:
        - "Any of the big lifts? Bench, squat, deadlift, overhead press?"
        - "Cardio - do you know your mile time?"
        - "Bodyweight - how many pull-ups or push-ups can you do?"
      extraction_hints:
        current_maxes:
          type: array
          items:
            type: object
            properties:
              exercise: string
              value: number
              unit: [lbs, kg, reps, seconds, minutes, "min:sec"]
          purpose: "Used for calculating working weights in workouts (e.g., 80% of max)"

    preferences:
      order: 11
      goal: "Training preferences"
      data_collected:
        - workout_duration
        - equipment_access
        - preferred_styles
        - workout_days
      feature_intro: "Personalized workout programming"
      transition_template: |
        Awesome! A few questions about how you like to train.

        How much time do you typically have for a workout?
      quick_replies:
        - "30 minutes"
        - "45 minutes"
        - "60 minutes"
        - "90+ minutes"
      follow_up_questions:
        - "What equipment do you have access to?"
        - "What days work best for you to work out?"
      extraction_hints:
        workout_duration:
          type: number
          unit: minutes
          common_values: [30, 45, 60, 90]
        equipment_access:
          type: array
          common_values: [full_gym, home_gym, dumbbells, barbells, machines, bodyweight_only, kettlebells, resistance_bands]
        workout_days:
          type: array
          values: [monday, tuesday, wednesday, thursday, friday, saturday, sunday]

    privacy:
      order: 12
      goal: "Set profile visibility preferences"
      data_collected:
        - profile_visibility
      feature_intro: "Control who can see your profile"
      transition_template: |
        Almost done! One last thing about your profile.

        Would you like your profile to be public or private?

        **Public** means others can find you when looking for workout partners. If someone wants to add you to their circle, you'll get a request to approve first.

        **Private** means you're invisible to search - you can only join circles through direct invitations.
      quick_replies:
        - "Public - I want to meet people"
        - "Private - invitation only"
      extraction_hints:
        profile_visibility:
          type: enum
          values: [public, private]
          default: private

    wrap_up:
      order: 13
      goal: "Summarize and create profile"
      data_collected: []
      feature_intro: "Your personalized dashboard"
      action: "generate_member_profile"
      completion_template: |
        {name}, you're all set! Here's what I learned about you:

        {profile_summary}

        I'm excited to start this fitness journey with you! Your dashboard is ready, and I'll be here whenever you need workout suggestions, want to track progress, or just need some motivation.

        Let's crush it! ðŸ’ª

  # Step tracking for resilient onboarding
  step_tracking:
    description: "Track status of each step for resilience"
    statuses:
      - pending     # Not yet asked
      - active      # Currently being asked
      - collected   # User provided data
      - skipped     # User chose to skip
      - corrected   # User corrected previous answer

    correction_patterns:
      - "actually, my"
      - "correction:"
      - "i meant to say"
      - "let me fix"
      - "that's wrong"
      - "change that to"
      - "wait, I'm"

    go_back_patterns:
      - "go back"
      - "previous"
      - "wait, let me"
      - "back to"

  # Data extraction schema for final profile creation
  extraction_schema:
    member:
      name:
        type: string
        required: true
        source: welcome.name_preference
      birth_month:
        type: number
        required: false
        source: basics.birth_month
      birth_year:
        type: number
        required: false
        source: basics.birth_year
      gender:
        type: enum
        values: [male, female, other]
        required: false
        source: basics.gender
      city:
        type: string
        required: false
        source: location.city
      profile_visibility:
        type: enum
        values: [public, private]
        required: false
        default: private
        source: privacy.profile_visibility
      profile_picture:
        type: string
        required: false
        source: profile_setup.profile_picture

    metrics:
      height_inches:
        type: number
        required: false
        calculated_from: basics.height
        calculation: "(feet * 12) + inches"
      weight_lbs:
        type: number
        required: false
        source: basics.weight
      body_fat_percentage:
        type: number
        required: false
        source: body_composition.body_fat_estimate
      target_weight_lbs:
        type: number
        required: false
        source: body_composition.target_weight
      fitness_level:
        type: enum
        values: [beginner, intermediate, advanced, elite]
        required: false
        source: fitness_background.experience_level

    goals:
      type: array
      items:
        type: string
        target_value: number
        target_unit: string
        target_date: date
      source: [goals.primary_goal, goals.secondary_goals]

    limitations:
      type: array
      items:
        type: string
        severity: enum
        affected_areas: array
      source: limitations.limitations

    personal_records:
      type: array
      items:
        exercise: string
        value: number
        unit: string
      source: personal_records.personal_records

    preferences:
      workout_duration_minutes:
        type: number
        source: preferences.workout_duration
      equipment:
        type: array
        source: preferences.equipment_access
      preferred_days:
        type: array
        source: preferences.workout_days

  # AI response guidelines
  response_guidelines:
    max_message_length: 200  # words
    tone: conversational
    emoji_usage: moderate
    personalization:
      - Reference user's name frequently
      - Callback to earlier answers
      - Acknowledge their specific situation

    transition_patterns:
      acknowledgment_starters:
        - "Love it!"
        - "Nice!"
        - "That's awesome!"
        - "Got it!"
        - "Perfect!"
        - "Great choice!"

      bridging_phrases:
        - "Now let's talk about..."
        - "Next up..."
        - "Moving on..."
        - "Here's a quick one..."
        - "Almost there!"

    skip_handling:
      phrases: ["skip", "pass", "don't know", "prefer not to say", "not sure"]
      response: "No problem! We can always update this later. Let's move on."
